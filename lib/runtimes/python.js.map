{"version":3,"sources":["../../src/runtimes/python.js"],"names":["fs","require","path","PythonRuntime","plugin","runtime","runtimeDir","packageManager","dependenciesPath","compatibleRuntimes","copyBeforeInstall","packageExclude","commands","pip","localpackageJson","join","process","cwd","localPackage","readFileSync","toString","e","log","exit","depsA","depsB","bucketService","downloadDependencesFile","remotePackage","isDifferent","isDiff","module","exports"],"mappings":";;;;;;;;;;;;AAAA,IAAMA,EAAE,GAAGC,OAAO,CAAC,IAAD,CAAlB;;AACA,IAAMC,IAAI,GAAGD,OAAO,CAAC,MAAD,CAApB;;IAEME,a;;;AACJ,yBAAYC,MAAZ,EAAoBC,OAApB,EAA6BC,UAA7B,EAAyC;AAAA;AACvC,SAAKF,MAAL,GAAcA,MAAd;AAEA,sBAAe;AACbC,MAAAA,OAAO,EAAPA,OADa;AAEbC,MAAAA,UAAU,EAAVA,UAFa;AAGbC,MAAAA,cAAc,EAAG,KAHJ;AAIbC,MAAAA,gBAAgB,EAAE,kBAJL;AAKbC,MAAAA,kBAAkB,EAAE,CAACJ,OAAD,CALP;AAMbK,MAAAA,iBAAiB,EAAE,EANN;AAObC,MAAAA,cAAc,EAAE,CACd,cADc,EAEd,mBAFc,EAGd,iBAHc;AAPH,KAAf;AAcA,SAAKC,QAAL,GAAgB;AACdC,MAAAA,GAAG,2BAAoB,gBAAaL,gBAAjC;AADW,KAAhB;AAIA,QAAMM,gBAAgB,GAAGZ,IAAI,CAACa,IAAL,CACvBC,OAAO,CAACC,GAAR,EADuB,EAEvB,gBAAaT,gBAFU,CAAzB;;AAKA,QAAI;AACF,WAAKU,YAAL,GAAoBlB,EAAE,CAACmB,YAAH,CAAgBL,gBAAhB,EAAkCM,QAAlC,EAApB;AACD,KAFD,CAEE,OAAOC,CAAP,EAAU;AACV,WAAKC,GAAL,+BAAgCR,gBAAhC;AACAE,MAAAA,OAAO,CAACO,IAAR,CAAa,CAAb;AACD;AACF;;;;2BAEMC,K,EAAOC,K,EAAO;AACnB,UAAI,CAACD,KAAL,EAAY;AACV,eAAO,IAAP;AACD;;AACD,aAAOA,KAAK,KAAKC,KAAjB;AACD;;;;;;;;;;;;;uBAG6B,KAAKrB,MAAL,CAAYsB,aAAZ,CAA0BC,uBAA1B,E;;;AAAtBC,gBAAAA,a;AAEFC,gBAAAA,W,GAAc,I;;qBAEdD,a;;;;;AACF,qBAAKxB,MAAL,CAAYkB,GAAZ,qBAA6B,gBAAad,gBAA1C;;uBACoB,KAAKsB,MAAL,CAAYF,aAAZ,EAA2B,KAAKV,YAAhC,C;;;AAApBW,gBAAAA,W;;;iDAGKA,W;;;;;;;;;;;;;;;;;;;;AAIXE,MAAM,CAACC,OAAP,GAAiB7B,aAAjB","sourcesContent":["const fs = require('fs');\nconst path = require('path');\n\nclass PythonRuntime {\n  constructor(plugin, runtime, runtimeDir) {\n    this.plugin = plugin;\n\n    this.default = {\n      runtime,\n      runtimeDir,\n      packageManager:  'pip',\n      dependenciesPath: 'requirements.txt',\n      compatibleRuntimes: [runtime],\n      copyBeforeInstall: [],\n      packageExclude: [\n        'package.json',\n        'package-lock.json',\n        'node_modules/**',\n      ]\n    };\n\n    this.commands = {\n      pip: `pip install -r ${this.default.dependenciesPath} -t .`,\n    };\n\n    const localpackageJson = path.join(\n      process.cwd(),\n      this.default.dependenciesPath\n    );\n\n    try {\n      this.localPackage = fs.readFileSync(localpackageJson).toString();\n    } catch (e) {\n      this.log(`Error: Can not find ${localpackageJson}!`);\n      process.exit(1);\n    }\n  }\n\n  isDiff(depsA, depsB) {\n    if (!depsA) {\n      return true;\n    }\n    return depsA !== depsB;\n  }\n\n  async hasDependencesChanged() {\n    const remotePackage = await this.plugin.bucketService.downloadDependencesFile();\n\n    let isDifferent = true;\n\n    if (remotePackage) {\n      this.plugin.log(`Comparing ${this.default.dependenciesPath} dependencies...`);\n      isDifferent = await this.isDiff(remotePackage, this.localPackage);\n    }\n\n    return isDifferent;\n  }\n}\n\nmodule.exports = PythonRuntime;\n"],"file":"python.js"}